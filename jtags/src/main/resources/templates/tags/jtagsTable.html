<jtags-table id="table-container"
             id-field="{config.idField}"
             icon-base-path="{config.iconBasePath}"
             {#if config.showCheckbox}show-checkbox{/if}
    {#if config.showSearch}show-search{/if}
             hx-get="{config.baseUrl}"
             hx-trigger="jtags-table-sort, jtags-table-search, jtags-table-page, jtags-table-size, jtags-table-refresh from:body"
             hx-target="#table-container"
             hx-swap="outerHTML"
             hx-push-url="true"
             hx-include="#searchField, #search, #pageSize, #sort, #asc, #page">

    {! Hidden inputs for state that isn't in form controls !}
    <input type="hidden" id="sort" name="sort" value="{state.sortBy ?: ''}">
    <input type="hidden" id="asc" name="asc" value="{state.ascending}">
    <input type="hidden" id="page" name="page" value="{state.page.currentPage}">
    <input type="hidden" id="selectionMode" name="selectionMode" value="ids">

    <jtags-toolbar search-field="{state.searchField ?: ''}"
                   search-value="{state.searchTerm ?: ''}"
                   total-items="{state.page.totalItems}"
                   page-size="{state.page.pageSize}">

        {#for action in config.toolbarActions}
            <jtags-action key="{action.key}"
                          label="{action.label}"
                          icon="{action.icon}"
                          {#if action.showLabel}show-label{/if}
                {#if action.selectionBased}selection-based{/if}
                    {#if action.confirm}
                        hx-get="{action.url}/confirm"
                        hx-target="#jtags-modal-container"
                        hx-swap="innerHTML"
                    {#else}
                        hx-{action.method}="{action.url}"
                        hx-target="#table-container"
                        hx-swap="outerHTML"
                    {/if}
                {#if action.selectionBased}hx-include="[name=select-item]:checked, #searchField, #search, #selectionMode"{/if}
            >
            </jtags-action>
        {/for}

    </jtags-toolbar>

    {#for column in config.columns}
        <jtags-column key="{column.key}"
                      label="{column.label}"
                      sortable
                      {#if config.searchableFields.contains(column.key)}searchable{/if}>
        </jtags-column>
    {/for}

    {! Grid - renders header from columns above, contains data rows !}
    <jtags-grid sort-by="{state.sortBy ?: ''}"
                {#if state.ascending}sort-asc{/if}
                empty-message="No data found">
        {#for item in state.page.items}
            <jtags-row item-id="{util:property(item, config.idField)}">
                {#for column in config.columns}
                    <jtags-cell column="{column.key}">{util:property(item, column.key)}</jtags-cell>
                {/for}
            </jtags-row>
        {/for}
    </jtags-grid>

    <jtags-pagination current="{state.page.currentPage}"
                      total="{state.page.totalPages}"
                      size="{state.page.pageSize}"
                      total-items="{state.page.totalItems}"
                      sizes="{#for size in config.pageSizeOptions}{size}{#if ! size_isLast},{/if}{/for}"
                      {#if config.showPaginationLabels}show-labels{/if}>
    </jtags-pagination>

</jtags-table>

{! Modal container for action confirmations - outside table swap zone !}
<div id="jtags-modal-container"></div>